<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Materiales | ReConstruye</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      padding-top: 70px;
      background: #f4f6f8;
    }

    .material-card {
      transition: transform .2s, box-shadow .2s;
      border-radius: 12px;
      overflow: hidden;
    }

    .material-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,.15);
    }

    .filter-box,
    .impact-box {
      background: white;
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 2rem;
      box-shadow: 0 6px 16px rgba(0,0,0,.08);
    }

    .impact-number {
      font-size: 1.8rem;
      font-weight: bold;
    }

    .eco-badge {
      position: absolute;
      top: 10px;
      right: 10px;
    }
  </style>
</head>

<body onload="requireAuth(); loadImpact();">

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
  <div class="container">
    <a class="navbar-brand fw-bold" href="dashboard.html">ReConstruye</a>

    <div class="ms-auto">
      <a href="createpost.html" class="btn btn-outline-light me-2">
        Publicar material
      </a>
      <a href="profile.html" class="btn btn-outline-info me-2">
        Perfil
      </a>
      <button onclick="logout()" class="btn btn-danger">
        Cerrar sesi√≥n
      </button>
    </div>
  </div>
</nav>

<!-- Contenido -->
<div class="container mt-4">

  <h2 class="fw-bold mb-4">Materiales disponibles</h2>

  <!-- üå± Impacto ambiental -->
  <div class="impact-box">
    <div class="row text-center">
      <div class="col-md-4">
        <div class="impact-number text-success" id="impactMaterials">0</div>
        <div class="text-muted">Materiales reutilizados</div>
      </div>

      <div class="col-md-4">
        <div class="impact-number text-primary" id="impactKg">0 kg</div>
        <div class="text-muted">Residuos evitados</div>
      </div>

      <div class="col-md-4">
        <div class="impact-number text-success" id="impactTrees">0</div>
        <div class="text-muted">√Årboles salvados </div>
      </div>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filter-box">
    <div class="row g-3">
      <div class="col-md-4">
        <input
          type="text"
          id="search"
          class="form-control"
          placeholder="Buscar por nombre o descripci√≥n">
      </div>

      <div class="col-md-4">
        <select id="filter" class="form-control">
          <option value="">Todos los materiales</option>
          <option>Cemento</option>
          <option>Madera</option>
          <option>Metal</option>
          <option>Ladrillo</option>
          <option>Vidrio</option>
          <option>Pl√°stico</option>
        </select>
      </div>

      <div class="col-md-4">
        <select id="priceFilter" class="form-control">
          <option value="">Precio</option>
          <option value="low">Menor a $20</option>
          <option value="mid">$20 - $100</option>
          <option value="high">Mayor a $100</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Lista de materiales -->
  <div class="row" id="materials"></div>
</div>

<!-- Scripts -->
<script src="js/auth.js"></script>
<script src="js/materials.js"></script>

<script>
  const searchInput = document.getElementById("search");
  const filterSelect = document.getElementById("filter");
  const priceSelect = document.getElementById("priceFilter");

  searchInput.addEventListener("input", applyFilters);
  filterSelect.addEventListener("change", applyFilters);
  priceSelect.addEventListener("change", applyFilters);

  function applyFilters() {
    renderMaterials(
      searchInput.value.toLowerCase(),
      filterSelect.value,
      priceSelect.value
    );
  }

  function loadImpact() {
    const posts = JSON.parse(localStorage.getItem("posts")) || [];
    const approved = posts.filter(p => p.approved);

    const materials = approved.length;
    const kg = materials * 25;
    const trees = Math.floor(kg / 20);

    document.getElementById("impactMaterials").innerText = materials;
    document.getElementById("impactKg").innerText = kg + " kg";
    document.getElementById("impactTrees").innerText = trees;
  }
</script>

</body>
</html>
